# POS System: OrderManager for Stores

## システム概要

- 店舗が発行するQRコードには、WEBページを発行するパラメータ付きURLが付与されている  
  - **目的:** 店舗と座席注文をデータベース上で管理するため
- QRリンクからアクセス時、API側でタイムスタンプを付与し注文ページURLを発行。WEB側は受け取り次第リダイレクト  
  - **目的:** 注文可能状態・期間を制限するため
- 注文時APIにて、タイムスタンプ及び注文ステータスと照合し注文を制限  
  - **目的:** 店舗外注文などを回避するため

---

## アーキテクチャ

- **Google Cloud**
  - Cloud Run
  - Firestore（リアルタイムリスナー）
  - Storage（Next.js静的ファイル）

---

## 環境変数

| 変数名     | 説明              |
| ---------- | ----------------- |
| PROJECT_ID | Google Project ID |
| TAXRATE    | 日本の消費税率    |

---

## 実装機能

### サービス提供主

1. 店舗ID発行（CRUD）
    - 店舗情報を店舗に提供（パスワードは入力されたデータ）

### 店舗側

1. 店舗管理情報取得
2. 店舗管理情報変更
3. 店舗メニュー（名前、説明、価格、数量、写真）を登録
4. 複数の座席ID（SeatID）を発行（ユーザ座席が注文者となる）
5. 座席ID（SeatID）から受注: [Orderドキュメント](./src/models/order-doc.md)
6. 追加注文を受注
7. 注文ステータスを更新
8. キャンセル受付
9. 注文ステータスがファイナライズされれば当座席注文会計および終了

### ユーザ側

1. 来店
2. QRコードを顧客に付与（StoreID, SeatIDが付与されたQR）
3. QRウェブサイトにアクセス（店舗・座席のセッションが発行され、ページとAPIでやりとり）
4. ブラウザにSessionJWTが付与されCookieに保存（有効期限切れで削除、再読み込みを促す）
5. 注文
    - ログイン無しで注文可能（考慮点・懸念点要確認）
    - 注文時はAPIに送信
    - GUI管理: expired_atを過ぎたら離脱（注文失注回避）。基本的に毎注文時QRからアクセス
6. APIで注文可能か確認
7. APIで店舗座席セッションに注文セット、小計返却、店舗側に通知
8. 現注文の状態制限あり、キャンセル・追加注文可能
9. 会計可能。店舗情報と顧客情報を照合し現金対応

---

## 機能追加検討

- Stripe等によるキャッシュレス決済
- ログインとポイント付与

---

## 開発手順

### 第1段階: MVP（最小viable product）

- QRコード読み取り → セッション生成
- メニュー表示
- 基本的な注文機能
- 注文状態確認

### 第2段階: 店舗管理機能

- 店舗情報管理画面
- メニュー管理（CRUD）
- 座席管理
- 注文受付・ステータス更新

### 第3段階: 追加機能

- 会計機能
- 詳細な注文履歴
- 統計・分析機能

---

### 並行開発のメリット

- 早期フィードバック
- UIの使いやすさを早期に検証
- API設計の問題点発見
- ユーザーストーリーの妥当性確認
- 開発効率向上（フロントエンド・バックエンド同時進行、API仕様変更の早期反映、統合テストの早期実施）